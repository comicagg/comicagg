"use strict";var clist=[];var maxwidth=0;var alreadyUpdating=false;var cdivInView=[];var divlist=[];function addSeed(b){var a=new Date();if(b.indexOf("?")===-1){b+="?"+a.getTime()}else{b+="&"+a.getTime()}return b}function loadImage(c,d,a){var b;b=new Image();d.cid=a.id;b.onload=function(){d.src=c;if(this.width>maxwidth){d.style.width="100%"}};b.onerror=function(){d.alt="ERROR";d.src=media_url+"images/error.png";comics[d.cid].error=true;$("reload"+d.cid).show()};b.src=c}function loadComic(b,a){var f,e,c,g,d;maxwidth=$("c"+b.id).select(".comicextra")[0].getDimensions().width;if(!b.loaded){f="reload"+b.id;$(f).hide();for(e=0;e<b.list.length;e=e+1){c=b.list[e];g=$("imgu"+c.unreadid);d=a?addSeed(c.url):c.url;loadImage(d,g,b)}if(b.list.length===0){g=$("imgl"+b.id);d=a?addSeed(b.last_url):b.last_url;loadImage(d,g,b)}b.loaded=true}}function inViewport(b,i,j){var a,g,d,f,e,c;a=b.cumulativeOffset().top;g=b.getHeight();d=a+g;f=a<=i&&d>=j;e=a>=i&&a<=j;c=d>=i&&d<=j;if(f||e||c){return true}else{return false}}function updateViewport(j){var d,a,g,h,e,f,b,c;if(alreadyUpdating){return 0}alreadyUpdating=true;d=2;a=false;g=document.viewport.getScrollOffsets().top;h=g+document.viewport.getHeight();cdivInView=[];for(e=0,f=divlist.length;e<f&&d>0;e=e+1){b=divlist[e];if(b.visible()){if(inViewport(b,g,h)){cdivInView.push(b);if(j){c=comics[b.id.substring(1)];loadComic(c,false)}a=true}else{if(a){cdivInView.push(b);if(j){c=comics[b.id.substring(1)];loadComic(c,false)}d-=1}}}}alreadyUpdating=false}function initLoadImages(){var b,d,c,a;updateViewport(false);b=cdivInView;while(b.length>0){d=b.shift();c=parseInt(d.id.substring(1),10);a=comics[c];if(a.last_url){loadComic(a,false)}}}function showAllComics(){var a;for(a=0;a<clist.length;a=a+1){clist[a].show()}$("showingAll").show();$("showingUnread").hide();updateViewport(true)}function showUnreadComics(){var a,b;for(a=0;a<clist.length;a=a+1){b=parseInt(clist[a].id.substring(1),10);if(!unreadComics[b]){clist[a].hide()}else{clist[a].show()}}$("showingAll").hide();$("showingUnread").show();updateViewport(true)}function onScrollHandler(a){setTimeout(function(){updateViewport(true)},10)}function initScrolling(){window.onscroll=onScrollHandler;divlist=$$(".comic")}function onReadLoad(){clist=$$(".comic");updateCounters();showUnreadComics();initScrolling();if(comicCounter){if(unreadCounter){initLoadImages()}else{return 0}}else{$("noComicsSelected").show()}}function reloadComic(b){var a=comics[b];a.loaded=false;a.error=false;loadComic(a,true)}function markread(d,b){var a,c;c={id:d,value:b};Element.show("working"+d);Element.hide("workingerror"+d);startRequest(url_mark_as_read,{method:"post",parameters:c,onSuccess:function(e){if(e.status===200){Element.hide("working"+d);Element.hide("workingerror"+d);Element.hide("reading"+d);Element.hide("newnotice"+d);Element.show("ok"+d);setTimeout("Element.hide('ok"+d+"')",5000);unreadComics[d]=false;updateCounters(e.responseJSON)}else{Element.hide("working"+d);Element.show("workingerror"+d)}},onFailure:function(e){Element.hide("working"+d);Element.show("workingerror"+d)},onException:function(f,e){Element.hide("working"+d);Element.show("workingerror"+d)}})}function reportbroken(e){var c,a,d,b;a=[];c=comics[e].list;if(c.length===0){a.push(comics[e].last_ch)}else{c.each(function(f){a.push(f.chid)})}d={id:e,"chids[]":a};Element.show("working"+e);Element.hide("workingerror"+e);startRequest(url_report,{method:"post",parameters:d,onSuccess:function(f){if(f.status===200){Element.hide("working"+e);Element.hide("workingerror"+e);Element.show("ok"+e);setTimeout("Element.hide('ok"+e+"')",5000)}else{Element.hide("working"+e);Element.show("workingerror"+e)}},onFailure:function(f){Element.hide("working"+e);Element.show("workingerror"+e)},onException:function(g,f){Element.hide("working"+e);Element.show("workingerror"+e)}})}function removecomic(d){var b,c,a;b={id:d};Element.show("working"+d);startRequest(url_remove,{method:"post",parameters:b,onSuccess:function(e){if(e.status===200){updateCounters(e.responseJSON);c=$("c"+d);a=c.next();while(a!==null&&!a.visible()){a=a.next()}if(a===null){a=c.previous();while(a!==null&&!a.visible()){a=a.previous()}}c.hide();c.remove();comics[d]=null;if($("comics").childElements().length===0){$("noComicsSelected").show()}else{a.scrollToExtra(-40)}}else{Element.hide("working"+d);Element.show("workingerror"+d)}},onFailure:function(e){Element.hide("working"+d);Element.show("workingerror"+d)},onException:function(f,e){Element.hide("working"+d);Element.show("workingerror"+d)}})}function mark_all_read(){var a;$("mark_all_read_anim").show();startRequest(url_mark_all_read,{onSuccess:function(b){if(b.status===200){$("mark_all_read_anim").hide();updateCounters(b.responseJSON);for(a=0;a<unreadComics.length;a=a+1){unreadComics[a]=false}showUnreadComics();$("mark_all_read").hide()}else{$("mark_all_read_anim").hide()}},onFailure:function(){$("mark_all_read_anim").hide()}})};