"use strict";function save(){var e,b,d,c,a;b=$("user_comics").select(".dojoDndItem");d=b[0].getAttribute("comicid");for(c=1,a=b.length;c<a;c=c+1){d+=","+b[c].getAttribute("comicid")}$("saving_text").show();$("save_error").hide();$("saved").hide();e={selected:d};startRequest(url_save_selection,{method:"post",parameters:e,onSuccess:function(f){var g;if(f.status===200){$("saved").show();$("saving_text").hide();g=setTimeout(function(){$("saved").hide()},6000)}else{$("saved").hide();$("save_error").show();$("saving_text").hide()}},onFailure:function(f){$("saved").hide();$("save_error").show();$("saving_text").hide()}})}function convertNodes(){var b,d,a,g,f;b=[];for(d=0,a=usercomics.length;d<a;d=d+1){g=usercomics[d];f=new Element("span",{comicid:g.id});f.innerHTML=g.name;b[d]=f}return b}var dojo_usercomics;function initDND(){var a;dojo_usercomics=new dojo.dnd.Source("user_comics",{horizontal:true});dojo.connect(dojo_usercomics,"onDropInternal",function(b,c){save()});dojo_usercomics.insertNodes(false,convertNodes());a=new dojo.dnd.Target("trash");dojo.connect(a,"onDropExternal",function(e,b,g){var d,c,f;$("saving_text").show();$("save_error").hide();$("saved").hide();a.selectAll();a.deleteSelectedNodes();a.clearItems();d=b[0].getAttribute("comicid");for(c=1;c<b.length;c=c+1){d+=","+b[c].getAttribute("comicid")}f={ids:d};startRequest(url_remove_list,{method:"post",parameters:f,onSuccess:function(h){var j,l,k;if(h.status===200){$("saved").show();$("saving_text").hide();j=setTimeout(function(){$("saved").hide()},6000);k=false;for(j=0;j<b.length;j=j+1){l=parseInt(b[j].getAttribute("comicid"),10);k=k||removeComicId(usercomics,l)}if(k){usercomics=usercomics.compact()}}else{$("saved").hide();$("save_error").show();$("saving_text").hide()}},onFailure:function(h){$("saved").hide();$("save_error").show();$("saving_text").hide()}})});dojo.dnd.Avatar.prototype._generateText=function(){return(this.manager.nodes.length+" comic"+(this.manager.nodes.length!==1?"s":""))}}function setNewList(a){dojo_usercomics.selectAll();dojo_usercomics.deleteSelectedNodes();dojo_usercomics.clearItems();dojo_usercomics.insertNodes(false,a)}function etoString(b){var a=b.name;a+=" "+b.score+"%";a+=" "+b.votes+"v";return a.toLowerCase()}function sort_az(d,c){d=etoString($(d));c=etoString($(c));if(d>c){return 1}else{if(d<c){return -1}else{return 0}}}function sort_score(e,d){var c,g,f;c=parseInt(e.score,10);g=parseInt(d.score,10);f=g-c;if(f===0){c=parseInt(e.votes,10);g=parseInt(d.votes,10);f=g-c;if(f===0){f=sort_az(e,d)}}return f}function sort_items(a){if(a){usercomics.sort(sort_az)}else{usercomics.sort(sort_score)}setNewList(convertNodes());save()};