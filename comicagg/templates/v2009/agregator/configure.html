{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans 'Read comics' %} - {% endblock %}
{% block extra_head %}
		<script src="{{ mediaurl }}js/lib/dojo/dojo.js" type="text/javascript"></script>
{% endblock%}
{% block onload %}{% endblock %}
{% block content %}
<h3>{% trans "Sort your comics" %}</h3>
<div id="trash">
	<p>{% trans "Drop comics here<br/>to delete them" %}</p>
</div>
<p>{% trans "Here you can sort your comics. Just select one or some of them (holding the Ctrl/Meta key) and drag them around." %}</p>
<div class="save">
	<button class="save_button" onclick="saveSort()">
		<span id="save_text">{% trans "Save" %}&nbsp;<img id="saved_ok" style="display:none" src="{{ mediaurl }}images/ok16.png" alt=""/><img id="save_error" style="display:none" src="{{ mediaurl }}images/remove.png" alt=""/></span>
		<span id="saving_text" style="display:none">{% trans "Saving..." %}&nbsp;<img src="{{ mediaurl }}images/loaderarrows.gif" alt=""/></span>
	</button>
</div>
<div class="text_center">
{% spaceless %}
	{% trans "Sort them:" %}&nbsp;
	<a>{% trans "by name" %}</a>,&nbsp;
	<a>{% trans "by score" %}</a>
{% endspaceless %}
</div>
<div class="comic_list">
	<div id="user_comics">
{% for comic in user_comics %}
		<span id="comic_{{ comic.id }}" class="dojoDndItem item">{{ comic }}</span>
{% endfor %}
	</div>
	<div style="clear:both"></div>
</div>

<script type="text/javascript">
	dojo.require("dojo.dnd.Container");
	dojo.require("dojo.dnd.Manager");
	dojo.require("dojo.dnd.Source");
	dojo.require("dojo.dnd.Avatar");

	function initDND() {
		var c1 = new dojo.dnd.Source("user_comics", {
			horizontal:true,
		});
		var trash = new dojo.dnd.Target("trash");
		dojo.connect(trash, "onDropExternal", function(source, nodes, copy) {
			trash.selectAll();
			trash.deleteSelectedNodes();
			trash.clearItems();
// 			trash.sync();
			console.debug("objs en papelera:" + trash.getAllNodes().length);
		});
		dojo.dnd.Avatar.prototype._generateText = function(){
			return (this.manager.nodes.length + " comic" + (this.manager.nodes.length != 1 ? "s" : ""));
		};
	}
	
	dojo.addOnLoad(initDND);
</script>
<!--<script type="text/javascript">
Sortable.create('user_comics', {
	tag:"span",
// 	ghosting:true,
	constraint:false,
	hoverclass:"itemhover",
	dropZoneCss:"dz",
	
});</script>-->
<!--<div class="comic_list">
{% for comic in available %}
<span>{{ comic }}</span>
{% endfor %}
<span style="clear:both"></span>
</div>-->
{% endblock %}