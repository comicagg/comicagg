{% extends 'base.html' %}
{% load i18n %}
<!-- {% block title %}{% trans 'Read' %} -{% endblock %} -->
{% block extra_head %}
		<script src="{{ mediaurl }}js/read.min.js" type="text/javascript"></script>
{% endblock%}
{% block onload %}onReadLoad();{% endblock %}
{% block content %}
<script language="javascript">
	var titlei18n = "{% trans 'Read' %}";
	var unreadComics = [];
	var comics = [];
{% for comic,unreadlist in unread_list %}
	unreadComics[{{ comic.id }}] = true;
{% endfor %}
{% for comic,unreadlist in comic_list %}
	tmp = [];
	{% if not comic.noimages or perms.agregator.all_images %}{% for unread in unreadlist %}tmp.push({"unreadid":{{ unread.id }}, "comicid":{{ comic.id }}, "chid":{{ unread.history.id }}, "url":"{{ unread.history.get_url|safe }}", "alt_text":"{{ unread.history.alt_text|default_if_none:"" }}"});{% endfor %}{% endif %}
	c = {"name":"{{ comic.name}}", "id":{{ comic.id }}, {% if not comic.noimages or perms.agregator.all_images %}"last_url":"{{ comic.get_url|safe }}", "last_alt_text":"{{ comic.last_image_alt_text|default_if_none:"" }}", "list":tmp, {% endif %}"error":false, "loaded":false, "last_ch":{{ comic.comichistory_set.all.0.id }}};
	comics[{{ comic.id }}] = c;
{% endfor %}
</script>
<div id="read">
	<div class="top_info">
		{% if unread_count %}
		<div id="mark_all_read">
			<a onclick="mark_all_read()">{% trans "Mark all comics as unread" %}</a>
			<img style="display:none" id="mark_all_read_anim" src="{{ mediaurl }}images/loaderarrows.gif" alt="working"/>
		</div>
		{% endif %}
		<p class="info" id="unreadCounters">{% blocktrans %}You are reading <b id="unreadCountersTotal">{{ comic_count }}</b> comics and <b id="unreadCountersUnread">{{ unread_count }}</b> of them have unread strips.{% endblocktrans %}</p>
		<p class="info" id="noUnreadCounters" style="display:none">{% blocktrans %}You are reading <b id="noUnreadCountersTotal">{{ comic_count }}</b> comics and none of them have unread strips.{% endblocktrans %}</p>
		<p class="info" id="showingUnread">{% blocktrans %}Showing only <b>unread</b> comics. <a onclick="showAllComics()">Click here</a> to show all comics.{% endblocktrans %}</p>
		<p class="info" id="showingAll" style="display:none">{% blocktrans %}Showing <b>all</b> comics. <a onclick="showUnreadComics()">Click here</a> to show only unread comics.{% endblocktrans %}</p>
	</div>
	<div id="comics">
	{% for comic,unreadlist in comic_list %}
	<div id="c{{ comic.id }}" class="comic" style="display:none">
		<h3>{{ comic.name }}</h3>
		{% if unreadlist %}<span id="newnotice{{ comic.id }}" class="newstripsnotice">{% trans "New strips!" %}</span>{% endif %}
		<div class="striplist">
		{% if comic.noimages and not perms.agregator.all_images %}
			{% blocktrans with comic.url as url %}The comic has been updated. <a href="{{ url }}">Click here</a> to go to the comic's website.{% endblocktrans %}
		{% else %}
			{% for unread in unreadlist %}
			{%  ifchanged %}<h5>{{ unread.history.date|date:"d F Y" }}</h5>{% endifchanged %}
			<img id="imgu{{ unread.id }}" src="{{ mediaurl }}images/striploading.gif" alt="new - loading..." title="{{ unread.history.alt_text|default_if_none:""|safe }}"/><br/>
			<div class="alttext">{{ unread.history.alt_text|default_if_none:""|safe }}</div>
			{% empty %}
			<h5>{{ comic.last_check|date:"d F Y" }}</h5>
			<img id="imgl{{ comic.id }}" src="{{ mediaurl }}images/striploading.gif" alt="last - loading..." title="{{ comic.last_image_alt_text|default_if_none:""|safe }}"/>
			<div class="alttext">{{ comic.last_image_alt_text|default_if_none:""|safe }}</div>
			{% endfor %}
		{% endif %}
		</div>
		<div class="comicextra">
			<div class="anims">
				<img id="working{{ comic.id }}" src="{{ mediaurl }}images/loaderarrows.gif" alt="" style="display:none"/>
				<img id="workingerror{{ comic.id }}" src="{{ mediaurl }}images/error12.png" alt="" style="display:none"/>
				<img id="ok{{ comic.id }}" src="{{ mediaurl }}images/ok12.png" alt="" style="display:none"/>
				&nbsp;
			</div>
			<div class="wrap">
				<div style="float:left">
					<span id="reload{{ comic.id }}" class="reload" style="display:none"><a onclick="reloadComic({{ comic.id }})">{% trans "Reload images" %}</a>&nbsp;&nbsp;&nbsp;&nbsp;</span>
					{% if unreadlist %}
					<span id="reading{{ comic.id }}">
						<a onclick="markread({{ comic.id }}, 0)">{% trans "Mark as read"%}</a>&nbsp;&nbsp;&nbsp;&nbsp;
						{% trans "Vote" %}&nbsp;&nbsp;
						<a onclick="markread({{ comic.id }}, -1)"><img src="{{ mediaurl }}/images/vote_down.png" alt="vote up"/></a>&nbsp;&nbsp;
						<a onclick="markread({{ comic.id }}, 1)"><img src="{{ mediaurl }}/images/vote_up.png" alt="vote up"/></a>&nbsp;&nbsp;&nbsp;&nbsp;
					</span>
					{% endif %}
				</div>
				<div style="text-align:right">
					<a onclick="openurl('{{ comic.website|safe }}')">{% trans "Visit its website" %}</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a onclick="reportbroken({{ comic.id }})">{% trans "Report broken image" %}</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a onclick="removecomic({{ comic.id }})">{% trans "Remove this comic" %}</a>&nbsp;&nbsp;&nbsp;&nbsp;
				</div>
			</div>
		</div>
		<h5 id="outc{{ comic.id }}"></h5>
	</div>
	{% endfor %}
	<div id="noComicsSelected" style="display:none" class="box">{% trans "You haven't selected any comics!" %}</div>
	</div>
</div>
{% endblock %}